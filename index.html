<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv='cache-control' content='no-cache'>
    <meta http-equiv='expires' content='0'>
    <meta http-equiv="pragma" content="no-cache">
    
    
    
    <title>flashcards</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="card-flip-animation.css">

    <script defer src="https://www.gstatic.com/firebasejs/7.13.1/firebase.js"></script>
  

  </head>
  <body>
              <div id="quiz"></div>
              <button id="submit">Submit</button>
              <div id="results"></div>

      <!--
      <div>
          <label for="makeQuiz">Quiz questions and answers</label>
          <input id="makeQuiz" type="file" style="">
          <div id="makeQuizOutput" class="m-3" style="height: 30vh; border: solid 5px;"></div>
      </div>
      -->
  
      <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getDatabase, set, ref, push, child, onValue, get } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
        
        const firebaseConfig = {
          databaseURL: "https://optical-flashcards-default-rtdb.firebaseio.com",
        };
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        var quizContainer = document.getElementById('quiz');
        var resultsContainer = document.getElementById('results');
        var submitButton = document.getElementById('submit');

        
        function GetQuizDataOnce(){
          const flashcardsInDB = ref(database);

          get(child(flashcardsInDB, "quizQuestionsAndAnswers"))
          .then((snapshot) => {
              var flashcards = [];
              snapshot.forEach(childSnapshot => {
                  flashcards.push(childSnapshot.val());
              });
                

              var quizElement = document.getElementById("quiz");

              /*const currentQuestion= document.createElement("h1");
              currentQuestion.className = "text-center my-5";*/
                
            for(let i = 0; i < flashcards.length; i++){
              // Create h5 element
                let question = document.createElement("h5");

                //set question text
                const questionText = document.createTextNode(flashcards[i]["question"]);
                //append question text to question
                question.appendChild(questionText);
                //append question to main element
                quizElement.appendChild(question);

                //create div for choices
                let div= document.createElement("div");
                div.className = "choices";



                for(let j = 0; j < flashcards[i]["choices"].length; j++){
                    const input = document.createElement("input");
                    const label = document.createElement("label");
                    const br = document.createElement("br");

                    if(flashcards[i]["choices"][j].indexOf(' ') >= 0){
                        flashcards[i]["choices"][j] = flashcards[i]["choices"][j].split(' ').join("-");

                    }


                    input.id = flashcards[i]["choices"][j];
                    input.type = "radio";
                    input.name = `question${i}`;
                    input.value = flashcards[i]["choices"][j];
                    div.appendChild(input);

                    label.htmlFor = flashcards[i]["choices"][j];
                    label.className = "ms-2 mb-1";
                    label.innerHTML = flashcards[i]["choices"][j].split("-").join(" "); 
                    div.appendChild(label);

                    div.appendChild(br);

                    quizElement.appendChild(div);

                }





            
            }




              /*var myCards = Array.prototype.slice.call(document.getElementById("main").getElementsByClassName("flash-card"));
              myCards.forEach(function(card){
                card.addEventListener("click",function(){
                  if(!card.childNodes[0].classList.contains("animate")){
                    for(var i = 0; i < card.childNodes.length; i++){
                      card.childNodes[i].classList.remove("animateReverse");
                      card.childNodes[i].classList.add("animate");
                      
                    }
                  }else{
                    for(var i = 0; i < card.childNodes.length; i++){
                      card.childNodes[i].classList.remove("animate");
                      card.childNodes[i].classList.add("animateReverse");
                    }
                  }
                });
                  
              });*/

              });
          
            }//GetQuizDataOnce()

       	function showResults(){
          const flashcardsInDB = ref(database);

          get(child(flashcardsInDB, "quizQuestionsAndAnswers"))
          .then((snapshot) => {
              var flashcards = [];
              snapshot.forEach(childSnapshot => {
                  flashcards.push(childSnapshot.val());
              });

        /*
        for(let i = 0; i < flashcards[i].choices.length; i++){
           for(let j = 0; j < flashcards[i].choices.length; j++){
             let choice = flashcards[i].choices[j];
             console.log(choice);
           }
        }
        */

        // Traverse the string character by character.
        /*
        for (var i = 0; i < newStr.length; ++i) {
          // Changing the ith character
          // to '-' if it's a space.
          if (newStr[i] === " ") {
            newStr[i] = "-";
          }
        }
        */

		// gather answer containers from our quiz
		var answerContainers = quizContainer.querySelectorAll('.choices');

		// keep track of user's answers
		var userAnswer = '';
		var numCorrect = 0;

		// for each question...
		for(var i=0; i<flashcards.length; i++){

			// find selected answer
			userAnswer = (answerContainers[i].querySelector('input[name=question'+i+']:checked')||{}).value;

            if(flashcards[i].answer.indexOf(' ') >= 0){
                flashcards[i].answer = flashcards[i].answer.split(" ").join("-");
            }

			// if answer is correct
			if(userAnswer===flashcards[i].answer){
				// add to the number of correct answers
				numCorrect++;

				// color the answers green
                answerContainers[i].querySelector(`label[for=${userAnswer}]`).style.color = 'lightgreen';
                let choicesToDisable = answerContainers[i].getElementsByTagName("input");
                for(let j = 0; j < choicesToDisable.length; j++){
                    choicesToDisable[j].disabled = true;
                    choicesToDisable[j].disabled = true;
                }

			}
            else if(userAnswer!==flashcards[i].answer){
                answerContainers[i].querySelector(`label[for=${userAnswer}]`).style.color = 'red';

                let choicesToDisable = answerContainers[i].getElementsByTagName("input");
                for(let j = 0; j < choicesToDisable.length; j++){
                    choicesToDisable[j].disabled = true;
                    choicesToDisable[j].disabled = true;
                }
            }
			// if answer is wrong or blank
			else{
				// color the answers red
				//answerContainers[i].style.color = 'red';
                //answerContainers[i].querySelector(`label[for=${userAnswer}]`).style.color = 'black';
			}
		}

		// show number of correct answers out of total
		resultsContainer.innerHTML = numCorrect + ' out of ' + flashcards.length;

        if( numCorrect < flashcards.length){
            let submitBtn = document.getElementById("submit");
            submitBtn.style.display = "none";
            let tryAgainBtn = document.createElement("button");
            tryAgainBtn.innerHTML = "Try Again";
            
            let resultsEl = document.getElementById("results");
            resultsEl.appendChild(tryAgainBtn);
            tryAgainBtn.setAttribute("onclick","window.location.reload()");
              
             
        }else{
             document.getElementById("submit").style.display = "none";
        }

    });


            
}

           //call GetQuizDataOnce and showResults
           GetQuizDataOnce(); 
           
           // on submit, show results
	       submitButton.onclick = function(){
		    showResults();
            let ele= document.getElementsByTagName('input');
            /*
            for(var i=0;i<ele.length;i++){
                ele[i].checked = false;
            } 
            */
            /*
            for(i = 0; i < radios.length; i++) {
              radios[i].onclick = function(e) {
                if(e.ctrlKey) {
                  this.checked = false;
                }
              }
            }
            */

           }


          
      </script>
  </body>
</html>
